{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/malik/Downloads/wall-street-playbook/lib/db.ts"],"sourcesContent":["import { neon, NeonQueryFunction } from '@neondatabase/serverless'\r\n\r\nlet sql: NeonQueryFunction<false, false> | null = null\r\n\r\nexport function getDb() {\r\n  if (!sql) {\r\n    if (!process.env.DATABASE_URL) {\r\n      throw new Error('DATABASE_URL environment variable is not set')\r\n    }\r\n    sql = neon(process.env.DATABASE_URL)\r\n  }\r\n  return sql\r\n}\r\n\r\n// Initialize database tables\r\nexport async function initDatabase() {\r\n  const db = getDb()\r\n  \r\n  await db`\r\n    CREATE TABLE IF NOT EXISTS email_subscribers (\r\n      id SERIAL PRIMARY KEY,\r\n      email VARCHAR(255) UNIQUE NOT NULL,\r\n      source VARCHAR(50) DEFAULT 'website',\r\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `\r\n\r\n  await db`\r\n    CREATE TABLE IF NOT EXISTS contact_submissions (\r\n      id SERIAL PRIMARY KEY,\r\n      first_name VARCHAR(100),\r\n      last_name VARCHAR(100),\r\n      email VARCHAR(255) NOT NULL,\r\n      subject VARCHAR(100),\r\n      message TEXT NOT NULL,\r\n      status VARCHAR(20) DEFAULT 'new',\r\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `\r\n\r\n  await db`\r\n    CREATE TABLE IF NOT EXISTS orders (\r\n      id SERIAL PRIMARY KEY,\r\n      stripe_session_id VARCHAR(255) UNIQUE,\r\n      stripe_customer_id VARCHAR(255),\r\n      email VARCHAR(255) NOT NULL,\r\n      product_type VARCHAR(50) NOT NULL,\r\n      product_id VARCHAR(100) NOT NULL,\r\n      amount INTEGER NOT NULL,\r\n      status VARCHAR(20) DEFAULT 'pending',\r\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `\r\n\r\n  await db`\r\n    CREATE TABLE IF NOT EXISTS resume_submissions (\r\n      id SERIAL PRIMARY KEY,\r\n      name VARCHAR(200) NOT NULL,\r\n      email VARCHAR(255) NOT NULL,\r\n      phone VARCHAR(50),\r\n      service_type VARCHAR(50) NOT NULL,\r\n      target_role VARCHAR(200),\r\n      target_firms TEXT,\r\n      current_status VARCHAR(100),\r\n      experience_level VARCHAR(50),\r\n      timeline VARCHAR(100),\r\n      specific_concerns TEXT,\r\n      additional_notes TEXT,\r\n      resume_url TEXT NOT NULL,\r\n      resume_filename VARCHAR(255),\r\n      status VARCHAR(30) DEFAULT 'pending',\r\n      payment_status VARCHAR(30) DEFAULT 'unpaid',\r\n      stripe_session_id VARCHAR(255),\r\n      amount_paid INTEGER,\r\n      admin_notes TEXT,\r\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `\r\n\r\n  // Add new payment columns if they don't exist (for existing tables)\r\n  try {\r\n    await db`ALTER TABLE resume_submissions ADD COLUMN IF NOT EXISTS payment_status VARCHAR(30) DEFAULT 'unpaid'`\r\n    await db`ALTER TABLE resume_submissions ADD COLUMN IF NOT EXISTS stripe_session_id VARCHAR(255)`\r\n    await db`ALTER TABLE resume_submissions ADD COLUMN IF NOT EXISTS amount_paid INTEGER`\r\n  } catch {\r\n    // Columns might already exist, ignore errors\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,MAA8C;AAE3C,SAAS;IACd,IAAI,CAAC,KAAK;QACR,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;YAC7B,MAAM,IAAI,MAAM;QAClB;QACA,MAAM,IAAA,2MAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;IACrC;IACA,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,KAAK;IAEX,MAAM,EAAE,CAAC;;;;;;;EAOT,CAAC;IAED,MAAM,EAAE,CAAC;;;;;;;;;;;EAWT,CAAC;IAED,MAAM,EAAE,CAAC;;;;;;;;;;;;EAYT,CAAC;IAED,MAAM,EAAE,CAAC;;;;;;;;;;;;;;;;;;;;;;;;EAwBT,CAAC;IAED,oEAAoE;IACpE,IAAI;QACF,MAAM,EAAE,CAAC,mGAAmG,CAAC;QAC7G,MAAM,EAAE,CAAC,sFAAsF,CAAC;QAChG,MAAM,EAAE,CAAC,2EAA2E,CAAC;IACvF,EAAE,OAAM;IACN,6CAA6C;IAC/C;AACF"}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/malik/Downloads/wall-street-playbook/app/api/init-db/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { initDatabase } from '@/lib/db'\r\n\r\n// This endpoint should be called once to initialize the database tables\r\nexport async function POST(request: NextRequest) {\r\n  // Allow in development OR with admin password\r\n  const isDev = process.env.NODE_ENV === 'development'\r\n  const authHeader = request.headers.get('authorization')\r\n  const adminPassword = process.env.ADMIN_PASSWORD\r\n  const isAuthorized = authHeader && adminPassword && authHeader.replace('Bearer ', '') === adminPassword\r\n  \r\n  if (!isDev && !isAuthorized) {\r\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n  }\r\n\r\n  try {\r\n    await initDatabase()\r\n    return NextResponse.json({ success: true, message: 'Database initialized with all tables including resume_submissions' })\r\n  } catch (error) {\r\n    console.error('Database init error:', error)\r\n    return NextResponse.json({ error: 'Failed to initialize database' }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,KAAK,OAAoB;IAC7C,8CAA8C;IAC9C,MAAM,QAAQ,oDAAyB;IACvC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc;IAChD,MAAM,eAAe,cAAc,iBAAiB,WAAW,OAAO,CAAC,WAAW,QAAQ;IAE1F;;IAIA,IAAI;QACF,MAAM,IAAA,sKAAY;QAClB,OAAO,2LAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAoE;IACzH,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,2LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF"}}]
}